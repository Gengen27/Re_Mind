<div class="container mx-auto px-4 py-8" style="max-width: 900px; margin: 0 auto; padding: 2rem 1rem;">
  <!-- Header -->
  <div class="mb-6" style="margin-bottom: 1.5rem;">
    <%= link_to "← 振り返り一覧に戻る", reminders_path, style: "color: var(--primary); text-decoration: none; font-weight: 600; font-size: 0.875rem;" %>
  </div>

  <div class="card" style="background: linear-gradient(to bottom, rgba(245, 158, 11, 0.05), white); border: 2px solid var(--warning);">
    <div style="text-align: center; margin-bottom: 2rem;">
      <div style="font-size: 4rem; margin-bottom: 1rem;">💭</div>
      <h1 style="font-size: 1.75rem; font-weight: 700; color: var(--gray-900); margin-bottom: 0.5rem;">
        振り返りを完了しました
      </h1>
      <p style="color: var(--gray-600);">
        未完了の項目がありましたが、振り返りをしただけでも素晴らしいです！
      </p>
    </div>

    <!-- Progress Summary -->
    <div style="padding: 1.5rem; background-color: white; border-radius: 0.75rem; margin-bottom: 2rem; border: 2px solid var(--gray-200);">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <span style="font-weight: 600; color: var(--gray-700);">完了状況</span>
        <span style="font-size: 1.5rem; font-weight: 700; color: var(--warning);">
          <%= @reminder.checked_items_count %> / <%= @reminder.total_items_count %>
        </span>
      </div>
      <div style="width: 100%; height: 10px; background-color: var(--gray-200); border-radius: 9999px; overflow: hidden;">
        <div style="width: <%= @reminder.completion_rate %>%; height: 100%; background-color: var(--warning); transition: width 0.3s;"></div>
      </div>
      <div style="text-align: center; margin-top: 0.5rem; font-size: 0.875rem; color: var(--gray-600);">
        <%= @reminder.completion_rate %>% 完了
      </div>
    </div>

    <% if @feedback.present? %>
      <!-- AI Feedback -->
      <div style="margin-bottom: 2rem;">
        <h2 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
          <svg style="width: 1.5rem; height: 1.5rem; color: var(--primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
          </svg>
          AIメンターからのメッセージ
        </h2>

        <!-- Overall Message -->
        <div style="padding: 1.5rem; background-color: rgba(79, 70, 229, 0.05); border-radius: 0.75rem; border-left: 4px solid var(--primary); margin-bottom: 1.5rem;">
          <p style="line-height: 1.8; color: var(--gray-800);">
            <%= @feedback['overall_message'] %>
          </p>
        </div>

        <!-- Praise Points -->
        <% if @feedback['praise_points']&.any? %>
          <div style="margin-bottom: 1.5rem;">
            <h3 style="font-weight: 600; margin-bottom: 0.75rem; color: var(--secondary); display: flex; align-items: center; gap: 0.5rem;">
              <svg style="width: 1.25rem; height: 1.25rem;" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
              </svg>
              よくできたこと
            </h3>
            <ul style="list-style: none; padding: 0; display: flex; flex-direction: column; gap: 0.5rem;">
              <% @feedback['praise_points'].each do |point| %>
                <li style="padding: 0.75rem; background-color: rgba(16, 185, 129, 0.05); border-radius: 0.5rem; display: flex; align-items: start; gap: 0.5rem;">
                  <span style="color: var(--secondary); font-size: 1.25rem;">✓</span>
                  <span style="flex: 1; color: var(--gray-700);"><%= point %></span>
                </li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <!-- Unchecked Analysis -->
        <% if @feedback['unchecked_analysis']&.any? %>
          <div style="margin-bottom: 1.5rem;">
            <h3 style="font-weight: 600; margin-bottom: 0.75rem; color: var(--warning); display: flex; align-items: center; gap: 0.5rem;">
              <svg style="width: 1.25rem; height: 1.25rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
              </svg>
              未完了項目について
            </h3>
            <div style="display: flex; flex-direction: column; gap: 1rem;">
              <% @feedback['unchecked_analysis'].each do |analysis| %>
                <div style="padding: 1.25rem; background-color: white; border: 2px solid var(--gray-200); border-radius: 0.75rem;">
                  <div style="font-weight: 600; margin-bottom: 0.75rem; color: var(--gray-900);">
                    □ <%= analysis['item'] %>
                  </div>
                  
                  <% if analysis['possible_reasons']&.any? %>
                    <div style="margin-bottom: 0.75rem;">
                      <div style="font-size: 0.875rem; font-weight: 600; color: var(--gray-600); margin-bottom: 0.5rem;">
                        考えられる理由：
                      </div>
                      <ul style="margin: 0; padding-left: 1.5rem; color: var(--gray-700); font-size: 0.875rem;">
                        <% analysis['possible_reasons'].each do |reason| %>
                          <li style="margin-bottom: 0.25rem;"><%= reason %></li>
                        <% end %>
                      </ul>
                    </div>
                  <% end %>
                  
                  <div style="padding: 0.75rem; background-color: rgba(79, 70, 229, 0.05); border-radius: 0.5rem; border-left: 3px solid var(--primary);">
                    <div style="font-size: 0.875rem; font-weight: 600; color: var(--primary); margin-bottom: 0.25rem;">
                      💡 アドバイス
                    </div>
                    <div style="font-size: 0.875rem; color: var(--gray-700); line-height: 1.6;">
                      <%= analysis['advice'] %>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>

        <!-- Next Steps -->
        <% if @feedback['next_steps']&.any? %>
          <div style="padding: 1.5rem; background-color: rgba(16, 185, 129, 0.05); border-radius: 0.75rem; border: 2px solid var(--secondary);">
            <h3 style="font-weight: 600; margin-bottom: 0.75rem; color: var(--secondary); display: flex; align-items: center; gap: 0.5rem;">
              <svg style="width: 1.25rem; height: 1.25rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
              </svg>
              次のステップ
            </h3>
            <ol style="margin: 0; padding-left: 1.5rem; color: var(--gray-800); display: flex; flex-direction: column; gap: 0.5rem;">
              <% @feedback['next_steps'].each do |step| %>
                <li style="line-height: 1.6;"><%= step %></li>
              <% end %>
            </ol>
          </div>
        <% end %>
      </div>
    <% else %>
      <!-- No AI Feedback -->
      <div style="padding: 2rem; text-align: center; background-color: var(--gray-50); border-radius: 0.75rem; margin-bottom: 2rem;">
        <p style="color: var(--gray-600); margin-bottom: 1rem;">
          AIフィードバックの生成に失敗しました。
        </p>
        <p style="font-size: 0.875rem; color: var(--gray-500);">
          次回の振り返りで再度チャレンジしてみましょう。
        </p>
      </div>
    <% end %>

    <!-- Actions -->
    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
      <%= link_to reminders_path, class: "btn btn-secondary", style: "flex: 1; justify-content: center;" do %>
        振り返り一覧へ
      <% end %>
      <%= link_to @reminder, class: "btn btn-outline", style: "flex: 1; justify-content: center;" do %>
        もう一度見る
      <% end %>
    </div>
  </div>
</div>

