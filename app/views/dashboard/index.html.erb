<div class="container" style="padding: 2rem 1rem;">
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-2" style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">
      ダッシュボード
    </h1>
    <p class="text-gray-600">ようこそ、<%= current_user.name %> さん</p>
  </div>

  <!-- Stats Grid -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon" style="background-color: rgba(79, 70, 229, 0.1);">
        <svg class="w-8 h-8" style="width: 2rem; height: 2rem; color: var(--primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
      </div>
      <div class="stat-label">総投稿数</div>
      <div class="stat-value"><%= @total_posts %></div>
    </div>

    <div class="stat-card">
      <div class="stat-icon" style="background-color: rgba(16, 185, 129, 0.1);">
        <svg class="w-8 h-8" style="width: 2rem; height: 2rem; color: var(--secondary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </div>
      <div class="stat-label">AI評価済み</div>
      <div class="stat-value"><%= @evaluated_posts %></div>
    </div>

    <div class="stat-card">
      <div class="stat-icon" style="background-color: rgba(245, 158, 11, 0.1);">
        <svg class="w-8 h-8" style="width: 2rem; height: 2rem; color: var(--warning);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
        </svg>
      </div>
      <div class="stat-label">平均スコア</div>
      <div class="stat-value"><%= @average_score || "—" %></div>
    </div>
  </div>

  <!-- Today's Reflections -->
  <% if @pending_reminders.any? %>
    <div class="card" style="border: 2px solid var(--primary); background: linear-gradient(to bottom, rgba(79, 70, 229, 0.05), white);">
      <div class="card-header">
        <h2 class="card-title" style="display: flex; align-items: center; gap: 0.5rem;">
          📅 今日の振り返り
          <span class="badge badge-primary"><%= @pending_reminders.count %></span>
        </h2>
      </div>
      
      <p class="text-gray-600 mb-4" style="margin-bottom: 1rem; color: var(--gray-600);">
        振り返りが必要な投稿があります。成長のために定期的に振り返りましょう！
      </p>

      <div class="space-y-3" style="display: flex; flex-direction: column; gap: 0.75rem;">
        <% @pending_reminders.each do |reminder| %>
          <div style="padding: 1rem; background-color: white; border: 1px solid var(--gray-200); border-radius: 0.5rem;">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
              <div style="flex: 1;">
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                  <span style="font-size: 1.25rem;">🔔</span>
                  <span class="badge badge-warning" style="font-size: 0.75rem;">
                    <%= reminder.reminder_type_name %>
                  </span>
                </div>
                <h3 style="font-weight: 600; color: var(--gray-900); margin-bottom: 0.25rem;">
                  <%= reminder.post.title %>
                </h3>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                  <span class="badge" style="background-color: <%= reminder.post.category.color %>; color: white; font-size: 0.75rem;">
                    <%= reminder.post.category.name %>
                  </span>
                  <span class="text-sm text-gray-500" style="font-size: 0.75rem;">
                    投稿日：<%= reminder.post.created_at.strftime('%Y/%m/%d') %>
                  </span>
                </div>
              </div>
              
              <div style="text-align: center; min-width: 80px;">
                <% if reminder.has_unchecked_items? %>
                  <div style="font-size: 0.875rem; color: var(--warning); font-weight: 600;">
                    <%= reminder.checked_items_count %>/<%= reminder.total_items_count %>
                  </div>
                  <div style="font-size: 0.75rem; color: var(--gray-500);">完了</div>
                <% else %>
                  <div style="font-size: 0.875rem; color: var(--secondary); font-weight: 600;">
                    ✓ 完了
                  </div>
                <% end %>
              </div>
            </div>
            
            <% if reminder.retry_count > 0 %>
              <div style="margin-top: 0.5rem; padding: 0.5rem; background-color: rgba(245, 158, 11, 0.1); border-radius: 0.375rem; font-size: 0.75rem; color: var(--warning);">
                💡 再挑戦 <%= reminder.retry_count %>回目
              </div>
            <% end %>
            
            <div style="margin-top: 0.75rem; display: flex; gap: 0.5rem;">
              <%= link_to "振り返る", reminder_path(reminder), class: "btn btn-primary btn-sm", style: "flex: 1; justify-content: center; font-size: 0.875rem; padding: 0.5rem 1rem;" %>
            </div>
          </div>
        <% end %>
      </div>
      
      <div style="margin-top: 1rem; text-align: center;">
        <%= link_to "すべての振り返りを見る →", reminders_path, class: "text-indigo-600", style: "text-decoration: none; color: var(--primary); font-weight: 600; font-size: 0.875rem;" %>
      </div>
    </div>
  <% end %>

  <!-- Main Content Grid -->
  <div style="display: grid; grid-template-columns: 1fr; gap: 1.5rem;">
    <!-- Recent Posts -->
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">最近の投稿</h2>
        <%= link_to "すべて見る →", posts_path, class: "text-indigo-600", style: "text-decoration: none; color: var(--primary); font-weight: 600; font-size: 0.875rem;" %>
      </div>
      
      <% if @recent_posts.any? %>
        <div class="space-y-4">
          <% @recent_posts.each do |post| %>
            <div class="border-b border-gray-200 pb-4" style="border-bottom: 1px solid var(--gray-200); padding-bottom: 1rem;">
              <div class="flex justify-between items-start mb-2" style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;">
                <div style="flex: 1;">
                  <%= link_to post.title, post, class: "text-lg font-semibold text-gray-900 hover:text-indigo-600", style: "text-decoration: none; color: var(--gray-900); font-size: 1.125rem; font-weight: 600;" %>
                  <div class="flex items-center gap-2 mt-1" style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.25rem;">
                    <span class="badge" style="background-color: <%= post.category.color %>; color: white;">
                      <%= post.category.name %>
                    </span>
                    <span class="text-sm text-gray-500"><%= post.created_at.strftime('%Y/%m/%d') %></span>
                  </div>
                </div>
                <% if post.ai_score %>
                  <div class="text-center" style="min-width: 60px;">
                    <div class="text-2xl font-bold" style="font-size: 1.5rem; font-weight: 700; color: <%= post.ai_score.rank_color %>;">
                      <%= post.ai_score.total_score %>
                    </div>
                    <div class="text-xs text-gray-500" style="font-size: 0.75rem;">点</div>
                  </div>
                <% end %>
              </div>
              <p class="text-gray-600 text-sm line-clamp-2" style="color: var(--gray-600); font-size: 0.875rem; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                <%= post.content %>
              </p>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-12" style="padding: 3rem 0; text-align: center;">
          <div class="text-6xl mb-4" style="font-size: 4rem; margin-bottom: 1rem;">📝</div>
          <p class="text-gray-600 mb-4">まだ投稿がありません</p>
          <%= link_to "最初の失敗ログを投稿する", new_post_path, class: "btn btn-primary" %>
        </div>
      <% end %>
    </div>

    <!-- Quick Actions -->
    <div class="card">
      <h2 class="card-title mb-4" style="margin-bottom: 1rem;">クイックアクション</h2>
      <div class="space-y-3" style="display: flex; flex-direction: column; gap: 0.75rem;">
        <%= link_to new_post_path, class: "btn btn-primary", style: "width: 100%; justify-content: center;" do %>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          <span>新しい失敗ログを投稿</span>
        <% end %>
        
        <%= link_to analytics_path, class: "btn btn-outline", style: "width: 100%; justify-content: center;" do %>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
          </svg>
          <span>成長分析を見る</span>
        <% end %>
        
        <%= link_to categories_path, class: "btn btn-outline", style: "width: 100%; justify-content: center;" do %>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
          </svg>
          <span>カテゴリ別に見る</span>
        <% end %>
      </div>
    </div>
  </div>
</div>

<style>
  @media (min-width: 1024px) {
    .container > div:last-child {
      grid-template-columns: 2fr 1fr !important;
    }
  }
</style>